<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Gamedev Canvas Workshop</title>
    <style>
    	* { padding: 0; margin: 0; }
    	canvas { background: #eee; display: block; margin: 2em auto 0; }
    </style>
</head>
<body>

<canvas id="myCanvas" width="480" height="600" style="border:1px solid #000000;" ></canvas>

<script>
var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");

ctx.fillStyle = "#ffffff";
ctx.fillRect(0, 0, canvas.width-1, canvas.height-1);


var array_bullet = [];
var array_alien = [];
var array_explode = [];
var ball_interval;
var image1 = new Image();
image1.src = './explode.png';
// tracing the mouse state
var globalX;  // location of mouse point when it moves

canvas.onmousemove= function(e) { 
    mmove(e);
}
canvas.onmousedown = function(e) { 
    ball_interval = setInterval(function(){ shoot(globalX) }, 80); 
}
canvas.onmouseup = function(e) {
	clearInterval(ball_interval);
}
canvas.onmouseleave = function(e) {
	clearInterval(ball_interval);
}

function ScreenTimer()
{
    // clear last sprites
    ctx.fillStyle = "#ffffff";
	ctx.fillRect(0, 0, canvas.width-1, canvas.height-1);
	
    for(var i=0;i<array_bullet.length;i++)
    {
        // The bullet arriving the top, delete the object
        if (array_bullet[i].Trigger()==false)
        {
            array_bullet.splice(i, 1);
            i--;
        }
    }
	for(var i=0;i<array_explode.length;i++)
    {
        if (array_explode[i].Trigger()==false)
        {
            array_explode.splice(i, 1);
            i--;
        }
    }
	for(var i=0;i<array_alien.length;i++)
    {
        array_alien[i].checkIfDead();
        if (array_alien[i].Trigger()==false)
        {
            array_alien.splice(i, 1);
            i--;
        }
    }
	
    requestAnimationFrame(ScreenTimer);
}

class alien {
    constructor(x) {
        this.x = x;
        this.y = 50;
        this.ballRadius = 20;
		this.isDead = 0;
    }
	checkIfDead() {
		for(var i=0;i<array_bullet.length;i++) {
			var y1 = this.y - (this.ballRadius);
			var y2 = this.y + (this.ballRadius);
			var x1 = this.x - (this.ballRadius);
			var x2 = this.x + (this.ballRadius);
			if ((array_bullet[i].y > y1 && array_bullet[i].y < y2) && (array_bullet[i].x > x1 && array_bullet[i].x < x2))
			{
				this.isDead = 1;
				array_bullet[i].isDead = 1;
			}
		}
	}
    Trigger()
    {
        if (!this.isDead) {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.ballRadius, 0, Math.PI*2);
            ctx.fillStyle = "red";
            ctx.fill();
            ctx.closePath();
        }
        else {
			var explode_object = new explode(this.x, this.y);
			array_explode.push(explode_object);
            return false;
		}
        // The object is movine, return true
        
        return true;
    }
};

class bullet {
    constructor(x) {
        this.x = x;
        this.y = canvas.height-10;
        this.dx = 0;
        this.dy = -14;
        this.ballRadius = 5;
		this.isDead = 0;
    }

    Trigger()
    {
        if (this.y > 0 && !this.isDead)
        {
            this.y += this.dy;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.ballRadius, 0, Math.PI*2);
            ctx.fillStyle = "#0095DD";
            ctx.fill();
            ctx.closePath();

        }
        else
            return false;
        // The object is movine, return true
        
        return true;
    }
};

class explode {
    constructor(x, y) {
        this.x = x;
        this.y = y;
		this.isDead = 0;
		this.sprite_x = 0;
		this.sprite_y = 0;
    }

    Trigger()
    {
        if (!this.isDead)
        {
			// remove object if sprite reaches the last
			if (this.sprite_x / 128 == 4 && this.sprite_y / 128 == 4) {
				this.isDead = 1;
			}
			// switch to lower part of sprite
			else if (this.sprite_x / 128 == 4) {
				this.sprite_x = 0;
				this.sprite_y += 128;
			}
			
			ctx.drawImage(
			   image1,
			   this.sprite_x,
			   this.sprite_y,
			   128,
			   128,
			   this.x - 40,
			   this.y - 40,
			   80,
			   80);
			this.sprite_x += 128;

        }
        else
            return false;
        // The object is movine, return true
        
        return true;
    }
};

function shoot(e) {
	var bullet_object = new bullet(e);
    array_bullet.push(bullet_object);
}
function mmove(e)
{
	globalX = e.offsetX;
}
function explod22e(x, y) {
	var explode_radius = 60;
	ctx.fillStyle = "#ffffff";
	ctx.fillRect(0, 0, canvas.width-1, canvas.height-1);
	ctx.beginPath();
    ctx.arc(x, y, explode_radius, 0, Math.PI*2);
    ctx.fillStyle = "yellow";
    ctx.fill();
    ctx.closePath();
	explode_radius -= 2;

	//requestAnimationFrame(explode(x, y));
	ctx.drawImage(image1, x, y);
	image1.src = './explode.gif';
}
// use it like a timer
ScreenTimer();
var count = 50;
for (var i=0; i<10; i++) {
	var alien_object = new alien(count);
	array_alien.push(alien_object);
	count += 50;
}
</script>

</body>
</html>
